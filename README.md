# EVA

The idea behind this project is to make a serverless telegram bot (make it as cheap as possible ðŸ’¸) using Google Cloud Functions, Firebase and a small cron running on Google App Engine, to notify me about some useful stuff in a kind of smart way. There will be some endpoints to interact with the cron and other applications like [IFTTT](https://ifttt.com/).

[Click here to check the telegram bot](https://t.me/eva_v1_bot)

### Install

To use this in your own project you should create a Google Project on Firebase and deploy the code on this repo following [this guide](https://firebase.google.com/docs/functions/get-started).

You must also set your bot's `API KEY` running:

```
firebase functions:config:set telegram.bot_key="YOUR_API_KEY"
```

Finally, you have to set your bot's webhook to the URL returned by the deploy. Using [HTTPIE](https://httpie.org/) it would be something like this:

```
http POST "https://api.telegram.org/botYOUR_BOT_API/setWebhook" url="https://us-central1-YOUR_GOOGLE_APP_ID.cloudfunctions.net/evaBot?token=YOUR_TOKEN"
```

Note: `YOUR_TOKEN` is a token generated by you :) to identify the origin of the request.

To check out more about telegram bots [click here](https://core.telegram.org/bots).

## Current telegram commands

### `\start`
`\start` will save your telegram info in the realtime database, under `/users/YOUR_USER_ID`.

## Current endpoints
### `/setUserLocation`
Receives data in the following structure:

```
{
  "user_id": YOUR_USER_ID,
  "location": "string"
}
```

Will append an object with the location and the time of the request under `/locations/YOUR_USER_ID`.

Note: This is currently being used with an applet in [IFTTT](https://ifttt.com/) (`location -> webhook`).
The idea behind it is to make notifications based on my location :), but you can use it for whatever.

## References

For a more detailed explanation check:
- [Write a basic Telegram bot using Google Cloud Functions](https://chatbotslife.com/write-a-basic-telegram-bot-using-google-cloud-functions-51ab026fe016) by [Migsar Navarro](https://medium.com/@migsarnavarro).

- [Google Cloud Functions: Scheduled Trigger](https://medium.com/@earlg3/google-cloud-functions-scheduled-trigger-915b5fb8310f) by [Earl Gay](https://medium.com/@earlg3).
